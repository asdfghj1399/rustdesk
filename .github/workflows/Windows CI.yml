name: "1Ô∏è‚É£ Windows Build (Manual Trigger Fixed)"

on:
  # ÊâãÂä®Ëß¶ÂèëÈÖçÁΩÆÔºàÂøÖÈ°ªÈ°∂Ê†ºÂÜôÔºå‰∏çËÉΩÊúâÁº©ËøõÔºâ
  workflow_dispatch:
    inputs:
      build_type:
        description: "Build Type"
        required: true
        default: "release"
        type: choice
        options:
          - "release"
          - "debug"
  
  # Ëá™Âä®Ëß¶ÂèëÈÖçÁΩÆ
  push:
    branches: [ master ]

jobs:
  build:
    name: "üõ†Ô∏è Build - ${{ github.event.inputs.build_type || 'release' }}"
    runs-on: windows-latest

    steps:
    - name: "1Ô∏è‚É£ Check Input Parameters"
      shell: pwsh
      run: |
        echo "Build Type: ${{ github.event.inputs.build_type || 'release' }}"
        echo "Event Name: ${{ github.event_name }}"
        
    - name: "2Ô∏è‚É£ Checkout Code"
      uses: actions/checkout@v4

    - name: "3Ô∏è‚É£ Build Verification"
      shell: pwsh
      run: |
        $buildType = "${{ github.event.inputs.build_type || 'release' }}"
        echo "Simulating $buildType build..."
        mkdir -p target\x86_64-pc-windows-msvc\$buildType
        echo "dummy" > target\x86_64-pc-windows-msvc\$buildType\rustdesk.exe
        echo "EXE_PATH=target\x86_64-pc-windows-msvc\$buildType\rustdesk.exe" >> $env:GITHUB_ENV

    - name: "4Ô∏è‚É£ Show Artifacts"
      shell: pwsh
      run: |
        dir target\x86_64-pc-windows-msvc\* -Recurse

    - name: "5Ô∏è‚É£ Upload Artifact"
      uses: actions/upload-artifact@v4
      with:
        name: "rustdesk-${{ github.event.inputs.build_type || 'release' }}"
        path: |
          ${{ env.EXE_PATH }}
        retention-days: 1
