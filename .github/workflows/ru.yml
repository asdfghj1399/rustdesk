- name: "4️⃣ Bulletproof Dependency Install"
  shell: powershell
  run: |
    $retryCount = 0
    $maxRetries = 3
    $packages = @("libvpx[core]", "libyuv[core]", "openssl[core]")
    
    :install_loop while ($retryCount -lt $maxRetries) {
      try {
        Write-Output "::group::Attempt $($retryCount+1)"
        & "$env:VCPKG_ROOT\vcpkg" install $packages `
          --triplet=x64-windows `
          --clean-after-build `
          --recurse `
          --x-asset-sources=clear
        
        if ($LASTEXITCODE -eq 0) { 
          Write-Output "::endgroup::"
          break install_loop 
        }
      } catch {
        Write-Output "::warning::Attempt failed: $_"
      }
      Write-Output "::endgroup::"
      $retryCount++
      Start-Sleep -Seconds (30 * $retryCount)
    }
    
    if ($retryCount -eq $maxRetries) {
      # 输出详细错误日志
      Get-Content "$env:VCPKG_ROOT\buildtrees\**\install-*.log" | Out-String
      Write-Output "::error::Failed to install: $packages"
      exit 1
    }
