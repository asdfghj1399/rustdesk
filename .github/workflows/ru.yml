name: RustDesk CI/CD (手动触发版)

on:
  # 手动触发配置
  workflow_dispatch:
    inputs:
      build_type:
        description: '选择构建类型'
        required: true
        default: 'release'
        type: choice
        options:
          - debug
          - release
      clean_cache:
        description: '清除构建缓存'
        type: boolean
        default: false

  # 自动触发配置（可选）
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    name: 构建项目
    runs-on: windows-latest
    steps:
    - name: 检出代码
      uses: actions/checkout@v4
      with:
        submodules: recursive

    - name: 构建项目
      run: cargo build --${{ github.event.inputs.build_type }}

    - name: 上传产物
      uses: actions/upload-artifact@v4
      with:
        name: rustdesk-bin
        path: target/${{ github.event.inputs.build_type }}/rustdesk.exe
