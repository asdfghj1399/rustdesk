name: RustDesk CI (ç¼–ç ä¿®å¤ç‰ˆ)

jobs:
  debug-path:
    runs-on: windows-latest
    steps:
    - name: Checkout Code
      uses: actions/checkout@v4
      with:
        submodules: recursive
        
    - name: Path Debugging
      shell: powershell
      env:
        PS_ENCODING: utf-8  # æ˜¾å¼å£°æ˜ç¼–ç 
      run: |
        # è®¾ç½®æ§åˆ¶å°ç¼–ç 
        [Console]::OutputEncoding = [System.Text.Encoding]::UTF8
        chcp 65001

        # ä½¿ç”¨çº¯ASCIIå­—ç¬¦æ˜¾ç¤ºè·¯å¾„
        $hbbPath = "$env:GITHUB_WORKSPACE\libs\hbb_common"
        Write-Output "##[group]ğŸ” Path Verification"
        Write-Output "Calculated Path (ASCII): $hbbPath"

        # å®‰å…¨è·¯å¾„è½¬æ¢
        $normalizedPath = $hbbPath -replace '\\{2,}', '\' -replace '/', '\'
        Write-Output "Normalized Path: $normalizedPath"

        # ç¼“å†²æ¨¡å¼è·¯å¾„æ£€æµ‹
        try {
            Set-Location $normalizedPath -ErrorAction Stop
            Write-Output "##[info]âœ… Successfully accessed: $(Get-Location)"
        } catch {
            Write-Output "::error::âŒ Path access failed! Diagnostics below..."
            Get-ChildItem "$env:GITHUB_WORKSPACE\libs" -Recurse | Format-Table FullName
            exit 1
        }

        # é™„åŠ è¯Šæ–­ä¿¡æ¯
        Write-Output "##[debug]Directory contents:"
        Get-ChildItem | Format-Table Name, Length, LastWriteTime
        Write-Output "##[endgroup]"
        
    - name: Build Verification
      shell: pwsh  # ä½¿ç”¨PowerShell Core
      run: |
        # UTF-8 BOM æ˜¾å¼å£°æ˜
        $OutputEncoding = [System.Text.Encoding]::UTF8
        Write-Output "æ„å»ºè·¯å¾„éªŒè¯..."
        cargo metadata --manifest-path "$env:GITHUB_WORKSPACE\libs\hbb_common\Cargo.toml" --format-version 1 --verbose
